<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>åå¤å±‹è¦ªå­ç¾é£Ÿè³¼ç‰©ä¸ƒæ—¥è¡Œç¨‹ â€” Final </title>
    <!-- Tailwind CDNï¼šç¢ºä¿æ¨£å¼èˆ‡ç•«å¸ƒé è¦½ä¸€è‡´ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Speed hints for image proxy/CDN -->
    <link rel="dns-prefetch" href="https://images.weserv.nl">
    <link rel="preconnect" href="https://images.weserv.nl" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700;800&family=Noto+Serif+TC:wght@700;800&display=swap" rel="stylesheet">
    <style>
      summary::-webkit-details-marker { display: none; }
      body { font-family: 'Noto Sans TC', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, 'PingFang TC', 'Microsoft JhengHei', 'Noto Sans CJK TC', sans-serif; }
      .title-font { font-family: 'Noto Serif TC', ui-serif, Georgia, serif; letter-spacing: .2px; }

      /* Gallery layout */
      .gallery-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: .5rem; }
      @media (min-width: 768px) { .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); } }
      .gallery-item { overflow:hidden; border-radius: .5rem; border:1px solid rgb(229 231 235); background:#fff; }
      .aspect-fixed { aspect-ratio: 4/3; }
      .gallery-item img { width:100%; height:100%; object-fit: cover; display:block; }

      /* Toggle: natural aspect ratio mode */
      .mode-natural .gallery-item { aspect-ratio: auto; }
      .mode-natural .gallery-item img { height:auto; object-fit: contain; background:#000; }

      /* Lightbox */
      dialog#lightbox { width: min(96vw, 1200px); border: none; padding: 0; background: transparent; }
      dialog#lightbox::backdrop { background: rgba(0,0,0,.7); }
      .lightbox-inner { position: relative; padding: .5rem; background: #000; border-radius: .75rem; }
      .lightbox-img { max-width: 92vw; max-height: 86vh; display: block; margin: auto; }
      .lightbox-close { position:absolute; top:.5rem; right:.5rem; background: rgba(255,255,255,.9); border: 1px solid rgb(229 231 235); padding: .25rem .5rem; border-radius: .5rem; font-size: .875rem; }
    
    </style>
  </head>
  <body class="min-h-screen bg-neutral-50 body-font">
    <!-- é ‚éƒ¨å·¥å…·åˆ— -->
    <div class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-white/70 bg-white/80 border-b">
      <div class="mx-auto max-w-6xl px-4 py-3 flex items-center gap-3">
        <div class="flex items-center gap-2">
          <span class="inline-block w-5 h-5 rounded bg-black"></span>
          <h1 class="text-xl sm:text-2xl font-semibold tracking-tight title-font">åå¤å±‹è¦ªå­ç¾é£Ÿè³¼ç‰©ä¸ƒæ—¥è¡Œç¨‹</h1>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <button id="modeToggle" class="border rounded-md px-3 py-1.5 text-xs">é¡¯ç¤ºæ¨¡å¼ï¼šä¸€è‡´å°ºå¯¸</button>
                    <button id="dljson" class="bg-black text-white rounded-md px-3 py-1.5 text-xs">åŒ¯å‡º JSON</button>
        </div>
      </div>
    </div>    <main class="mx-auto max-w-6xl px-4 pb-16 pt-6">
      <!-- Hero -->
      <section class="mb-6">
        <div class="relative overflow-hidden rounded-2xl border shadow-sm">
          <img src="https://www.legoland.jp/media/lvqbobyy/entrance_3-1.jpg" alt="Hero" class="w-full h-64 object-cover" fetchpriority="high" referrerpolicy="no-referrer" crossorigin="anonymous">
        </div>
      </section>

      <div class="my-6 border-t"></div>

      <!-- èˆªç­å€å¡Š -->
      <section class="mb-8" id="flights">
        <div class="flex items-center gap-2 py-2">
          <span class="text-xl">âœˆï¸</span>
          <h2 class="text-2xl font-semibold tracking-tight title-font">èˆªç­</h2>
        </div>
        <div class="shadow-sm rounded-xl border bg-white scroll-mt-24">
          <div class="p-3 grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- å»ç¨‹ -->
            <div class="rounded-xl border p-4">
              <div class="flex items-center gap-2 mb-2"><span class="inline-flex items-center justify-center rounded-full bg-gray-100 border px-2 py-0.5 text-xs">å»ç¨‹</span></div>
              <div class="text-base text-gray-700 font-medium">æ—¥æœ¬èˆªç©º JAL</div>
              <div class="flex items-center gap-2 mt-1 text-sm"><span class="inline-flex items-center rounded-full bg-gray-100 border px-2 py-0.5">JL8670</span><span>2025/08/31 (æ—¥)</span></div>
              <div class="grid grid-cols-2 gap-2 items-center mt-2 text-base">
                <div class="flex items-center gap-2 text-lg font-semibold">14:05</div>
                <div class="text-right text-gray-500">æ¡ƒåœ’æ©Ÿå ´ ç¬¬2èˆªå»ˆ (TPE T2)</div>
                <div class="flex items-center gap-2 text-lg font-semibold">17:50</div>
                <div class="text-right text-gray-500">ä¸­éƒ¨åœ‹éš›æ©Ÿå ´ ç¬¬1èˆªå»ˆ (NGO T1)</div>
              </div>
            </div>
            <!-- å›ç¨‹ -->
            <div class="rounded-xl border p-4">
              <div class="flex items-center gap-2 mb-2"><span class="inline-flex items-center justify-center rounded-full bg-gray-100 border px-2 py-0.5 text-xs">å›ç¨‹</span></div>
              <div class="text-base text-gray-700 font-medium">æ—¥æœ¬èˆªç©º JAL</div>
              <div class="flex items-center gap-2 mt-1 text-sm"><span class="inline-flex items-center rounded-full bg-gray-100 border px-2 py-0.5">JL8671</span><span>2025/09/06 (å…­)</span></div>
              <div class="grid grid-cols-2 gap-2 items-center mt-2 text-base">
                <div class="flex items-center gap-2 text-lg font-semibold">10:40</div>
                <div class="text-right text-gray-500">ä¸­éƒ¨åœ‹éš›æ©Ÿå ´ ç¬¬1èˆªå»ˆ (NGO T1)</div>
                <div class="flex items-center gap-2 text-lg font-semibold">12:45</div>
                <div class="text-right text-gray-500">æ¡ƒåœ’æ©Ÿå ´ ç¬¬2èˆªå»ˆ (TPE T2)</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- æ¯æ—¥è¡Œç¨‹ï¼ˆç”± JS å‹•æ…‹ç”¢ç”Ÿï¼‰ -->
      <section class="mb-8" id="itinerary">
        <div class="flex items-center gap-2 py-2">
          <span class="text-xl">ğŸ—“ï¸</span>
          <h2 class="text-2xl font-semibold tracking-tight title-font">æ¯æ—¥è¡Œç¨‹</h2>
        </div>
        <div id="itineraryList" class="space-y-6"></div>
      </section>

      <!-- Lightbox (click-to-zoom) -->
      <dialog id="lightbox">
        <div class="lightbox-inner">
          <img id="lightboxImg" class="lightbox-img" alt="preview">
          <button id="lightboxClose" class="lightbox-close">é—œé–‰ âœ•</button>
        </div>
      </dialog>

    </main>

    <script>
      // åŒ¯å‡º JSONï¼ˆèˆ‡é é¢å…§å®¹åŒæ­¥çš„è³‡æ–™çµæ§‹ï¼‰
      const DATA = {
        title: "åå¤å±‹è¦ªå­ç¾é£Ÿè³¼ç‰©ä¸ƒæ—¥è¡Œç¨‹",
        subtitle: "",
        hero: { image: "https://www.legoland.jp/media/lvqbobyy/entrance_3-1.jpg", caption: "" },
        flights: {
          outbound: { airline: "æ—¥æœ¬èˆªç©º JAL", number: "JL8670", date: "2025/08/31 (æ—¥)", depTime: "14:05", dep: "æ¡ƒåœ’æ©Ÿå ´ ç¬¬2èˆªå»ˆ (TPE T2)", arrTime: "17:50", arr: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´ ç¬¬1èˆªå»ˆ (NGO T1)" },
          inbound:  { airline: "æ—¥æœ¬èˆªç©º JAL", number: "JL8671", date: "2025/09/06 (å…­)", depTime: "10:40", dep: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´ ç¬¬1èˆªå»ˆ (NGO T1)", arrTime: "12:45", arr: "æ¡ƒåœ’æ©Ÿå ´ ç¬¬2èˆªå»ˆ (TPE T2)" }
        },
        itinerary: [
          { day:1, date:"2025/08/31 (æ—¥)", title:"æŠµé”åå¤å±‹ãƒ»å…¥ä½é£¯åº—", gallery:[
              "https://photo.settour.com.tw/900x600/https://www.settour.com.tw/ss_img/info/location/NGO/O0/NGO0000012/NGO0000012_56401.jpg",
              "https://www.princehotels.co.jp/nagoya/images/night-view%20meieki01.jpg",
              "https://www.princehotels.co.jp/nagoya/experience/common/img/img_cont06-1.jpg"
            ] },
          { day:2, date:"2025/09/01 (ä¸€)", title:"æ¨‚é«˜æ¨‚åœ’è¦ªå­å†’éšªæ—¥", gallery:[
              "https://www.legoland.jp/media/pjagn2v5/hero_re3.jpg",
              "https://www.legoland.jp/media/vzifm0xv/1daypass.jpg",
              "https://www.legoland.jp/media/kvymb2eh/%E7%AB%9C%E5%AE%AE%E5%9F%8E.jpg?format=webp&quality=80&width=1920&height=768"
            ] },
          { day:3, date:"2025/09/02 (äºŒ)", title:"åå¤å±‹æ¸¯æ°´æ—é¤¨ãƒ»LaLaport è³¼ç‰©ãƒ»Anitouch å®¤å…§å‹•ç‰©åœ’", gallery:[
              "https://nagoyaaqua.jp/images/language/img6.jpg",
              "https://nagoyaaqua.jp/images/language/img1.jpg",
              "https://www.nagoya.anitouch.com/wp-content/themes/anitouch/assets/img/top/nekoashi.png"
            ] },
          { day:4, date:"2025/09/03 (ä¸‰)", title:"å‰åœåŠ›å…¬åœ’å¤¢å¹»æ¢éšª", gallery:[
              "https://ghibli-park.jp/site/img/about/daisouko/img12.jpg",
              "https://www.nagoya-info.jp/upload/spots/large/121592624163c0b4cc69d85.jpg",
              "https://www.nagoya-info.jp/upload/spots/large/173925933163c0b45bde951.jpg",
              "https://magazine.atnavi.net/wp-content/uploads/2024/03/DSC_6618-1024x682.jpg"
            ] },
          { day:5, date:"2025/09/04 (å››)", title:"ä¹…å±‹å¤§é€šå…¬åœ’æ•£æ­¥ãƒ»æ¦®å€é€›è¡—è³¼ç‰©", gallery:[
              "https://www.nagoya-info.jp/upload/spots/large/20368120235f5f2bd90de30.jpg",
              "https://www.nagoya-info.jp/upload/spots/large/111069977762259ea6adcb8.jpg",
              "https://chiikawa-info.jp/chiikawaland/nagoya/img/main_02.jpg",
              "https://pokemonnewspaper.com.au/wp-content/uploads/2024/10/Screenshot-2024-10-18-104428s.png"
            ] },
          { day:6, date:"2025/09/05 (äº”)", title:"åå¤å±‹è»Šç«™è³¼ç‰©ãƒ»æ©Ÿå ´å‰å¤œ", gallery:[
              "https://www.nagoya-info.jp/upload/spots/large/15516837935e46533ce5220.jpg",
              "https://www.centrair.jp/flight-of-dreams/assets/images/flight-park/img-kv.jpg"
            ] },
          { day:7, date:"2025/09/06 (å…­)", title:"è¿”å®¶ï¼ˆæ—©ç­æ©Ÿï¼‰", gallery:[
              "https://www.centrair.jp/assets/img/event/enjoy-skydeck-slide-img03.jpg"
            ] }
        ]
      };

      // æ¯æ—¥ç´°ç¯€ï¼ˆç˜¦èº«ï¼šä»¥è³‡æ–™çµæ§‹å‘ˆç¾ï¼Œçµ±ä¸€ç”± JS æ¸²æŸ“ï¼›ä¹‹å¾Œå¯ç›´æ¥æŠŠ Word å…§å®¹åŒæ­¥é€²ä¾†è¦†è“‹é€™è£¡ï¼‰
      const DETAILS = {
        1: {
          transport: [
            "æ©Ÿå ´ NGO â†’ åéµåå¤å±‹ï¼šæ­ã€Î¼-SKYã€ç´„30åˆ†ï¼›æˆ–ä¸€èˆ¬ç‰¹æ€¥35â€“40åˆ†ï¼›çš†å¯ç”¨ IC å¡ã€‚",
            "åå¤å±‹é§… â†’ ã•ã•ã—ã¾ãƒ©ã‚¤ãƒ–ï¼šé’æ³¢ç·š1ç«™æ­¥è¡Œå¯é”ï¼›äº¦å¯æ­¥è¡Œ/è¨ˆç¨‹è»Šï¼›GLOBAL GATE æœ‰é€£é€šå‹•ç·šã€‚"
          ],
          meals: { 
            breakfast: "â€”", 
            lunch: "æ©Ÿä¸Š/è‡ªç†", 
            dinner: "Sasashima Live å‘¨é‚Šè¼•é£Ÿ/é¤å»³ï¼ˆä¾‹ï¼šDining & Bar ONEONEã€L'Amour ç­‰ï¼‰" 
          },
          lodging: "åå¤å±‹å¤©ç©ºå¡”ç‹å­é£¯åº—ï¼ˆGLOBAL GATEï¼‰",
          summary: "æŠµé”NGO â†’ åéµé€²å¸‚å€ï¼Œå…¥ä½ åå¤å±‹å¤©ç©ºå¡”ç‹å­é£¯åº—ï¼ˆGLOBAL GATEï¼‰ï¼Œæ™šé–“å¯é€› MaxValu æˆ–å•†å ´ç°¡å–®è¦“é£Ÿã€‚",
          sections: [
            { title: "ä½å®¿è³‡è¨Š", items: ["åå¤å±‹å¤©ç©ºå¡”ç‹å­é£¯åº—ï¼›åœ°å€ï¼šæ„›çŸ¥çœŒåå¤å±‹å¸‚ä¸­æ‘åŒºå¹³æ± ç”º4-60-12ï¼›Check-in 15:00 èµ·ã€‚"] },
            { title: "å‘¨é‚Š/ä¾¿åˆ©", items: ["GLOBAL GATE å…§è¨­ FamilyMartï¼›å•†åœˆé¤å»³/å’–å•¡å¤šï¼Œç”Ÿæ´»æ©Ÿèƒ½ä½³ã€‚","FamilyMart å¸¸è¦‹ 07:00â€“23:00ï¼ˆä»¥ç¾å ´ç‚ºæº–ï¼‰ã€‚","MaxValu 24hr è¶…å¸‚ï¼ˆæ­¥è¡Œç´„ 600mï¼‰ï¼Œæ™šé–“æ¡è²·å‚™æ¡ˆã€‚"] },
            { title: "è¦ªå­æé†’", items: ["æå‰å‚™å¦¥ IC å¡ï¼›æŠŠéš”æ—¥æ¨‚é«˜æ¨‚åœ’ç”¨å“å…ˆæ•´ç†å¥½ã€‚","é¦–æ—¥æ™šåˆ°ä»¥å…¥ä½èˆ‡ä¼‘æ¯ç‚ºä¸»ï¼Œç„¡å®‰æ’æ­£å¼è§€å…‰ã€‚"] }
          ]
        },
        2: {
          transport: [
            "é£¯åº— â†’ ã•ã•ã—ã¾ãƒ©ã‚¤ãƒ–é§…ï¼šæ­¥è¡Œç´„5åˆ†ã€‚",
            "ã•ã•ã—ã¾ãƒ©ã‚¤ãƒ– â†’ é‡‘åŸãµé ­ï¼šé’æ³¢ç·šç´„24åˆ†ï¼›ç´„æ¯15åˆ†ä¸€ç­ï¼Œå»ºè­° 08:00â€“08:30 æ­ä¹˜ã€‚",
            "é‡‘åŸãµé ­é§… â†’ æ¨‚é«˜æ¨‚åœ’ï¼šæ²¿ Makerâ€™s Pier æ­¥è¡Œç´„7åˆ†æŠµå…¥å£ã€‚"
          ],
          meals: { 
            breakfast: "é£¯åº—/ä¾¿åˆ©å•†åº—ï¼›éº¥ç•¶å‹å¯å¿«é€Ÿè£œçµ¦", 
            lunch: "åœ’å…§é¤å»³ï¼ˆBricksï¼Knightâ€™s Table ç­‰ï¼‰", 
            dinner: "åå¤å±‹é§…å‘¨é‚Šï¼šESCA åœ°ä¸‹è¡—ï¼ˆçŸ¢å ´è±¬æ’ã€é¢¨ä¾†åŠ ç­‰ï¼‰" 
          },
          lodging: "åå¤å±‹å¤©ç©ºå¡”ç‹å­é£¯åº—ï¼ˆGLOBAL GATEï¼‰",
          summary: "é’æ³¢ç·šå‰å¾€ æ¨‚é«˜æ¨‚åœ’ï¼SEA LIFEï¼Œæ™šé¤å›åç«™ ESCA åœ°ä¸‹è¡—ï¼ˆçŸ¢å ´è±¬æ’ã€é¢¨ä¾†åŠï¼‰ã€‚",
          sections: [
            { title: "åœ’å€é‡é»", items: ["ä¸ƒå¤§ä¸»é¡Œå€ï¼Œå¾å‹•æ‰‹å‰µä½œåˆ°é›²éœ„é£›è»Šçš†æœ‰ã€‚","è¿·ä½ æ¨‚åœ’ï¼ˆMinilandï¼‰ï¼šä»¥ç©æœ¨é‡ç¾æ—¥æœ¬åŸå¸‚åœ°æ¨™ã€‚"] },
            { title: "éŠæ¨‚/è¡¨æ¼”", items: ["é¨å£«ç‹åœ‹ï¼šThe Dragon é›²éœ„é£›è»Šã€‚","æ¢éšªå€ï¼šLost Kingdom Adventure å°„æ“Šäº’å‹•ã€‚","å¿è€…ä¸–ç•Œï¼šä¸»é¡ŒéŠæ¨‚èˆ‡è¡¨æ¼”ã€‚","æµ·ç›œ/æ°´ä¸Šå€ï¼šå¯èƒ½æ¿ºæ¿•ï¼Œå¤å­£æ¸…æ¶¼ã€‚"] },
            { title: "åœ’å…§è³¼ç‰©", items: ["The Big Shop é™å®šå•†å“ï¼›Makerâ€™s Pier å‘¨é‚Šè¦ªå­å•†åº—ã€‚"] },
            { title: "åç«™è³¼ç‰©", items: ["Disney Storeï¼ˆåå¤å±‹ç«™å‘¨é‚Šï¼‰ã€‚"] },
            { title: "è£å‚™å»ºè­°", items: ["æ°´ä¸Šå€è«‹å‚™æ³³è¡£ã€é˜²æ›¬ã€æ›¿æ›è¡£ç‰©èˆ‡æ¯›å·¾ã€‚","SEA LIFE æ°´æ—é¤¨èˆ‡æ¨‚é«˜æ¨‚åœ’é€£é€šï¼ˆå¸¸è¦‹ç‚ºå¥—ç¥¨ï¼Œå¯å½ˆæ€§å®‰æ’é€²å‡ºï¼‰ã€‚"] }
          ]
        },
        3: {
          transport: [
            "æ°´ä¸Šäº¤é€šï¼šã•ã•ã—ã¾ãƒ©ã‚¤ãƒ– é‹æ²³ç¢¼é ­ â†’ åå¤å±‹æ¸¯ï¼Œåå¤å±‹æ°´ä¸Šå·´å£«ï¼è§€å…‰èˆ¹ç´„40â€“60åˆ†ã€‚",
            "è§€å…‰èˆ¹ç¯„ä¾‹ç­æ¬¡ï¼š9:30 â†’ 10:14ï¼ˆå¯¦éš›ä»¥å®˜ç¶²ç‚ºæº–ï¼‰ã€‚",
            "é™¸ä¸Šäº¤é€šï¼šæˆ–æ”¹æ­åœ°éµåæ¸¯ç·šè‡³åå¤å±‹æ¸¯ï¼ˆæ°´æ—é¤¨å‡ºç«™æ­¥è¡Œå¯é”ï¼‰ã€‚",
            "åå¤å±‹æ¸¯ â†’ LaLaportï¼šæ­¥è¡Œç´„10â€“15åˆ†ï¼Œæˆ–åœ°éµ1ç«™ã€‚"
          ],
          meals: { breakfast: "ä¾¿åˆ©å•†åº— Family", lunch: "æ°´æ—é¤¨æˆ– LaLaport ç¾é£Ÿè¡—", dinner: "LaLaport é¤å»³è¡—" },
          lodging: "åå¤å±‹å¤©ç©ºå¡”ç‹å­é£¯åº—ï¼ˆGLOBAL GATEï¼‰",
          summary: "æ­è§€å…‰èˆ¹è‡³ åå¤å±‹æ¸¯æ°´æ—é¤¨ï¼Œä¹‹å¾Œé€› LaLaport èˆ‡ Anitouchï¼ˆå®¤å…§å‹•ç‰©åœ’ï¼‰ã€‚",
          sections: [
            { title: "åå¤å±‹æ¸¯æ°´æ—é¤¨é‡é»", items: ["å—é¤¨ï¼šå—æ¥µ/èµ¤é“æµ·åŸŸï¼›åŒ—é¤¨ï¼šæµ·è±š/è™é¯¨ç­‰ã€‚","è¦ªå­äº’å‹•å±•å€è±å¯Œï¼Œé©åˆåŠæ—¥ä»¥ä¸Šåœç•™ã€‚"] },
            { title: "è¡¨æ¼”/å‹•ç·š", items: ["æµ·è±šç§€ç­‰ç†±é–€ï¼Œå»ºè­°å…ˆçœ‹å ´æ¬¡è¡¨è¦åŠƒå‹•ç·šã€‚"] },
            { title: "è³¼ç‰©/è¨­æ–½", items: ["ç´€å¿µå“åº—ï¼šæµ·æ´‹ä¸»é¡Œç©å¶èˆ‡æ•™å…·ã€‚","LaLaportï¼šè¦ªå­æœé£¾ã€å‹•æ¼«å‘¨é‚Šã€æ–‡å…·ï¼›è¨­æœ‰è¦ªå­éŠæ¨‚å€ï¼Œé›¨å¤©å‚™æ¡ˆä½³ã€‚","Anitouch ä½æ–¼ LaLaport 2F çš„å®¤å…§å‹•ç‰©åœ’ï¼Œå…¨å¤©å€™ç‡Ÿé‹ã€‚"] },
            { title: "ç‡Ÿæ¥­æ™‚é–“", items: ["æ°´æ—é¤¨å¸¸è¦‹ 9:30â€“17:30ï¼›LaLaport 10:00â€“21:00ï¼ˆé¤é£²æˆ–è‡³22:00ï¼‰ï¼›Anitouch 10:00â€“19:00ï¼ˆä»¥å®˜ç¶²ç‚ºæº–ï¼‰ã€‚"] }
          ]
        },
        4: {
          transport: ["åå¤å±‹é§… â†’ è—¤ãŒä¸˜é§…ï¼šåœ°éµæ±å±±ç·šç´„30åˆ†ã€‚","è—¤ãŒä¸˜ â†’ æ„›ãƒ»åœ°çƒåšè¨˜å¿µå…¬åœ’é§…ï¼šLinimo ç´„15åˆ†ã€‚"],
          meals: { 
            breakfast: "Komeda", 
            lunch: "åœ’å…§å’–å•¡å»³è¼•é£Ÿ", 
            dinner: "åå¤å±‹é§…ï¼Sasashima Liveï¼›æ¦®å€ï¼šé¦¬å–°ä¸€ä»£ï¼ˆï½23:00ï¼‰" 
          },
          lodging: "åå¤å±‹å¤©ç©ºå¡”ç‹å­é£¯åº—ï¼ˆGLOBAL GATEï¼‰",
          summary: "Linimo é€² å‰åœåŠ›å…¬åœ’ï¼ˆå¤§å€‰åº«ï¼Dondokoä¹‹æ£®ï¼‰ï¼Œæ™šé¤å¯è‡³ æ¦®å€ é¦¬å–°ä¸€ä»£ï¼Œé †éŠ ç¶ æ´²21ï¼å”å‰è¨¶å¾·ã€‚",
          sections: [
            { title: "åˆ†å€/äº®é»", items: ["é’æ˜¥ä¹‹ä¸˜ã€å‰åœåŠ›å¤§å€‰åº«ã€Dondokoä¹‹æ£®ã€é­”æ³•æ•…é‡Œã€é­”å¥³ä¹‹è°·ï¼ˆå¤šå€éœ€åˆ†åˆ¥è³¼ç¥¨ï¼‰ã€‚","å¤§å€‰åº«ï¼šç¶“å…¸å ´æ™¯å±•ç¤ºï¼ˆè²“å·´å£«ã€æ©Ÿå™¨äººå…µï¼‰ã€‚","Dondokoä¹‹æ£®ï¼šã€Šé¾è²“ã€‹ï¼›é­”å¥³ä¹‹è°·ï¼šã€Šé­”å¥³å®…æ€¥ä¾¿ã€‹ã€‚"] },
            { title: "ç¥¨åˆ¸/å»ºè­°", items: ["ç†±é–€æ™‚æ®µé–€ç¥¨æ˜“å”®ç½„ï¼Œå»ºè­°è‡³å°‘æå‰2å€‹æœˆé è¨‚ã€‚","åœ’å€æ­¥è¡Œé‡å¤§ï¼Œè«‹ç©¿å¥½èµ°é‹ï¼Œå¤å­£æ³¨æ„é˜²æ›¬è£œæ°´ã€‚"] },
            { title: "ç‡Ÿé‹æé†’", items: ["é€±äºŒå¸¸æ…‹ä¼‘åœ’ï¼ˆé€¢å‡æ—¥èª¿æ•´ï¼‰ï¼›Linimo ç´„10åˆ†ä¸€ç­ï¼Œè«‹ä»¥å®˜ç¶²ç‚ºæº–ã€‚"] },
            { title: "å›ç¨‹é †éŠ", items: ["ç¶ æ´²21","å”å‰è¨¶å¾·"] }
          ]
        },
        5: {
          transport: ["é£¯åº— â†’ æ¦®/ä¹…å±‹å¤§é€šï¼šåœ°éµç´„10â€“15åˆ†ï¼ˆååŸç·šæˆ–æ±å±±ç·šï¼‰ã€‚"],
          meals: { 
            breakfast: "VIE DE FRANCE æ¦®åœ°ä¸‹è¡—; å…¬åœ’å‘¨é‚Šå’–å•¡å»³æ—©åˆé¤ï¼›Blue Bottle è—ç“¶ï¼ˆä¸­æ—¥å¤§æ¨“ï¼‰", 
            lunch: "ç™¾è²¨é¤å»³è¡—ï¼›HARBS æ¦®æœ¬åº—ä¸‹åˆèŒ¶ï¼ˆ11:00â€“22:00ï¼‰", 
            dinner: "æ¦®å€/åœ°ä¸‹è¡—è‡ªç†ï¼›è“¬èŠè»’ï¼ˆæ¾å‚å±‹å—é¤¨10Fï¼ŒLO 20:30)" 
          },
          lodging: "åå¤å±‹å¤©ç©ºå¡”ç‹å­é£¯åº—ï¼ˆGLOBAL GATEï¼‰",
          summary: "ä¹…å±‹å¤§é€šï½æ¦®å€ ç™¾è²¨èˆ‡åœ°ä¸‹è¡—ã€åå¤å±‹ PARCOï¼ˆè§’è‰²é›œè²¨ï¼å¯¶å¯å¤¢ä¸­å¿ƒï¼‰ï¼Œé¤é£²å¯é¸ HARBSã€è“¬èŠè»’ã€Blue Bottleã€‚",
          sections: [
            { title: "è³¼ç‰©é‡é»", items: ["ä¸‰è¶Šï¼šç²¾å“/åœ°ä¸‹ç¾é£Ÿï¼›æ¾å‚å±‹ï¼šè¦æ¨¡å¤§ã€é¡åˆ¥é½Šå…¨ï¼›åœ°ä¸‹è¡—ï¼šå¹³åƒ¹æœé£¾èˆ‡è—¥å¦ã€‚","Parcoï¼šæ±é¤¨ 2F/3F è§’è‰²é›œè²¨ï¼ˆJump Shopã€Sanrio ç­‰ï¼‰ã€‚","å¯¶å¯å¤¢ä¸­å¿ƒï¼š2024/10/12 æ¬è‡³åå¤å±‹ PARCO æ±é¤¨2æ¨“ã€‚","å¤§é ˆå•†åº—è¡—ï¼šå¤è‘—/äºŒæ‰‹ã€å‹•æ¼«å‘¨é‚Šèˆ‡å°åƒçš„åº¶æ°‘å•†åœˆï¼ˆå¯èˆ‡æ¦®å€éŠœæ¥å®‰æ’ï¼‰ã€‚"] },
            { title: "PARCO æ¥­æ…‹å°è¦½", items: ["B1ï¼šè²“ç¦çŠè¿ªï½œ2Fï¼šå¯¶å¯å¤¢ä¸­å¿ƒï½œ3Fï¼šæ‡¶æ‡¶ç†Šãƒ»ç±³è²ãƒ»å²åŠªæ¯”ãƒ»å‰ä¼Šå¡å“‡ï½œ4Fï¼šanimate & æ‰­è›‹ã€‚"] },
            { title: "å¯¦ç”¨è³‡è¨Š", items: ["PARCO å„å±¤çš†æœ‰é›»æ¢¯ï¼›æ±é¤¨å»ºè­°é ç•™ 1.5â€“2 å°æ™‚ã€‚","ç‡Ÿæ¥­æ™‚é–“ï¼šParco 10:00â€“21:00ï¼ˆä»¥ç¾å ´ç‚ºæº–ï¼‰ã€‚"] }
          ]
        },
        6: {
          transport: ["åå¤å±‹é§… â†’ ä¸­éƒ¨åœ‹éš›æ©Ÿå ´ï¼šåéµç‰¹æ€¥ç´„30â€“40åˆ†ï¼Œç­æ¬¡å¯†é›†ã€‚","æ©Ÿå ´æ­¥è¡Œå‹•ç·šå®Œå–„ï¼Œè¾¦ç†å…¥ä½å¾Œå¯ç›´æ¥å‰å¾€è¨­æ–½ã€‚"],
          meals: { 
            breakfast: "åç«™ï¼šæ˜Ÿå·´å…‹ï¼æ˜Ÿä¹ƒçˆç²åº—ï¼éº¥ç•¶å‹ å¯ä½œæ›¿ä»£", 
            lunch: "è»Šç«™ç™¾è²¨ç¾é£Ÿè¡—", 
            dinner: "æ©Ÿå ´é¤å»³è¡—ï¼ˆç”œé»ï¼šå¼æ‰å¤© æ°´æœå¤§ç¦ï¼‰" 
          },
          lodging: "ä¸­éƒ¨ç©ºæ¸¯æ–°ç‰¹éº—äºé£¯åº—",
          summary: "åç«™æ¡è²· JR é«˜å³¶å±‹ï¼åéµç™¾è²¨ï¼BIC CAMERAã€JR Gate Towerï¼›åˆå¾Œè½‰å¾€æ©Ÿå ´ï¼Œæ¢è¨ª Flight of Dreamsã€‚",
          sections: [
            { title: "è³¼ç‰© & æ´»å‹•", items: ["JR é«˜å³¶å±‹ã€åéµç™¾è²¨ã€åœ°ä¸‹è¡—ã€BIC CAMERA ä½œç‚ºæœ€å¾Œæ¡è²·é»ã€‚","æ©Ÿå ´å…ç¨…åº—ï¼šè¿”å°å‰æœ€å¾Œè£œè²¨é»ã€‚","JR Gate Towerï¼ˆé¤é£²/å±•æœ›ï¼‰ã€‚","Disney Storeï¼ˆåç«™ï¼‰ã€‚"] },
            { title: "Flight of Dreams", items: ["å±•ç¤º Boeing 787ã€é§•é§›è‰™æ¨¡æ“¬èˆ‡ AR äº’å‹•ï¼Œå»ºè­° 15:00 å‰æŠµé”ã€‚"] },
            { title: "è¨­æ–½/è¦ªå­", items: ["æ©Ÿå ´é¤å»³è¡—å¤šå…ƒï¼›è¨­æœ‰å“ºä¹³å®¤èˆ‡å…’ç«¥éŠæˆ²å€ã€‚","è‹¥è¡Œæè¼ƒå¤šï¼Œå»ºè­°ææ—©è¾¦ç†æ©Ÿå ´é£¯åº— Check-inã€‚"] },
            { title: "ç‡Ÿé‹/æ™‚åˆ»", items: ["Flight of Dreams å¸¸è¦‹ 10:00â€“17:00ï¼›åéµç‰¹æ€¥è«‹è¡Œå‰æŸ¥æ™‚åˆ»è¡¨ã€‚"] }
          ]
        },
        7: {
          transport: ["æ©Ÿå ´é£¯åº— â†’ èˆªå»ˆï¼šæ­¥è¡Œç´„5åˆ†ï¼Œå¯å…ˆæ–¼ä¾¿åˆ©å•†åº—è³¼è²·æ—©é¤ã€‚"],
          meals: { breakfast: "ä¾¿åˆ©å•†åº—/å’–å•¡å»³", lunch: "â€”ï¼é£›æ©Ÿé¤ï¼ˆè¦–èˆªç­ä¾›é¤ï¼‰", dinner: "â€”" },
          lodging: "â€”",
          summary: "æ­¥è¡Œè‡³èˆªå»ˆè¾¦ç†ç™»æ©Ÿï¼Œè¦–æ™‚é–“æœ€å¾Œé€›å…ç¨…åº—å¾Œè¿”å®¶ã€‚",
          sections: [ { title: "å‡ºç™¼æé†’", items: ["æ­¥è¡Œ 5 åˆ†é˜å¯é”èˆªå»ˆï¼Œè«‹é ç•™å®‰æª¢èˆ‡ç¨…å‹™æ™‚é–“ã€‚","è‹¥æ™‚é–“å……è£•ï¼Œå¯æœ€å¾Œé€›å…ç¨…åº—è³¼è²·ä¼´æ‰‹ç¦®èˆ‡é›¶é£Ÿã€‚"] } ]
        }
      };

      // ä¸‹è¼‰ JSON æª”
      document.getElementById('dljson').addEventListener('click', () => {
        const blob = new Blob([JSON.stringify({DATA, DETAILS}, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'nagoya-ezstyle.json'; a.click(); URL.revokeObjectURL(url);
      });

      // å·¥å…·ï¼šç”¢ç”Ÿæ¸…å–® & å°ç¯€ HTML
      // æ—¢æœ‰å“ç‰Œ/æ™¯é»å®˜æ–¹é€£çµï¼ˆåƒ…åŒ¹é…å®Œå…¨è©ï¼‰
      const POI_LINKS = {
        "æ¨‚é«˜æ¨‚åœ’": "https://www.legoland.jp/",
        "LEGOLAND": "https://www.legoland.jp/",
        "SEA LIFE": "https://www.legoland.jp/",
        "Anitouch": "https://www.nagoya.anitouch.com/",
        "å‰åœåŠ›å…¬åœ’": "https://ghibli-park.jp/",
        "åå¤å±‹æ¸¯æ°´æ—é¤¨": "https://www.nagoyaaqua.jp/",
        "ç¶ æ´²21": "https://www.oasis-21.jp/",
        "å”å‰è¨¶å¾·": "https://www.donki.com/",
        "åå¤å±‹ PARCO": "https://nagoya.parco.jp/",
        "PARCO": "https://nagoya.parco.jp/",
        "Parco": "https://nagoya.parco.jp/",
        "å¯¶å¯å¤¢ä¸­å¿ƒ": "https://www.pokemon.co.jp/",
        "HARBS": "https://www.harbs.co.jp/",
        "è“¬èŠè»’": "https://www.horaiken.co.jp/",
        "Blue Bottle": "https://bluebottlecoffee.jp/",
        "è—ç“¶": "https://bluebottlecoffee.jp/",
        "Komeda": "https://www.komeda.co.jp/",
        "VIE DE FRANCE": "https://www.viedefrance.co.jp/",
        "JR Gate Tower": "https://www.towers.jp/",
        "JR é«˜å³¶å±‹": "https://www.jr-takashimaya.co.jp/",
        "åéµç™¾è²¨": "https://www.e-meitetsu.com/",
        "BIC CAMERA": "https://www.biccamera.co.jp/",
        "Flight of Dreams": "https://www.centrair.jp/flight-of-dreams/",
        "åå¤å±‹å¤©ç©ºå¡”ç‹å­é£¯åº—": "https://www.princehotels.co.jp/nagoya/",
        "ESCA åœ°ä¸‹è¡—": "https://www.esca-sc.com/",
        "çŸ¢å ´è±¬æ’": "https://www.yabaton.com/",
        "é¢¨ä¾†åŠ": "https://www.furaibou.com/",
        "Disney Store": "https://www.disney.co.jp/store/"
      };
      const escReg = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

      function linkify(txt=''){
        let out = String(txt ?? '');
        // Longer keywords first to avoid partial-shadowing (e.g., "åå¤å±‹ PARCO" before "PARCO")
        const entries = Object.entries(POI_LINKS).sort((a,b)=>b[0].length-a[0].length);
        // Use placeholders to avoid nested replacements when keys overlap
        const placeholders = [];
        entries.forEach(([k,url], idx)=>{
          if(!k) return;
          const ph = `__POI_${idx}__`;
          if (out.indexOf(k) !== -1) {
            out = out.split(k).join(ph);
            placeholders[idx] = `<a href="${url}" target="_blank" rel="noopener" class="underline decoration-dotted">${k}</a>`;
          } else {
            placeholders[idx] = null;
          }
        });
        placeholders.forEach((html, idx)=>{
          if(html) out = out.split(`__POI_${idx}__`).join(html);
        });
        return out;
      }
      const ul = items => `<ul class="list-disc pl-5 space-y-1">${(items||[]).map(i=>`<li>${linkify(i)}</li>`).join('')}</ul>`;

      const mealsBlock = m => `
        <div class="rounded-xl border p-3 text-sm bg-white">
          <div class="flex items-center gap-2 mb-2">ğŸ½ï¸ ä¸‰é¤</div>
          <ul class="space-y-1">
            <li>æ—©é¤ï¼š${linkify((m && m.breakfast) || '')}</li>
            <li>åˆé¤ï¼š${linkify((m && m.lunch) || '')}</li>
            <li>æ™šé¤ï¼š${linkify((m && m.dinner) || '')}</li>
          </ul>
        </div>`;

      const lodgingBlock = txt => `
        <div class="rounded-xl border p-3 text-sm bg-white">
          <div class="flex items-center gap-2 mb-2">ğŸ›ï¸ ä½å®¿</div>
          <div>${linkify(txt || '')}</div>
        </div>`;

      const galleryHTML = (day, urls=[]) => `
        <div class="gallery-grid mt-2" data-day="${day}">
          ${urls.map(u=>`<div class="gallery-item aspect-fixed"><img src="${u}" alt="d${day}" class="w-full h-full object-cover cursor-zoom-in" loading="lazy" decoding="async" referrerpolicy="no-referrer" crossorigin="anonymous"></div>`).join('')}
        </div>`;

      const cardHTML = (d, det) => `
        <div id="day-${d.day}" class="shadow-sm rounded-xl border bg-white scroll-mt-24">
          <div class="p-4 border-b">
            <div class="flex items-baseline justify-between flex-wrap gap-2">
              <div class="flex items-center gap-3">
                <span class="inline-flex items-center justify-center rounded-full bg-black text-white px-3 py-1 text-base md:text-lg font-semibold">ç¬¬ ${d.day} å¤©</span>
                <span class="text-lg md:text-2xl font-semibold tracking-tight">${d.date}</span>
              </div>
            </div>
            <div class="text-xl md:text-2xl mt-2 font-semibold">${linkify(d.title)}</div>
          </div>
          ${(det.summary ? `<div class="px-4 pt-2 text-gray-700 text-sm md:text-base">${linkify(det.summary)}</div>` : '')}
          ${galleryHTML(d.day, d.gallery)}
          <!-- äº¤é€šå‹•ç·š -->
          <div class="rounded-xl border p-3 text-sm bg-white mt-2">
            <div class="flex items-center gap-2 mb-2">ğŸš† äº¤é€šå‹•ç·š</div>
            ${ul(det.transport || [])}
          </div>
          <!-- é¤é£Ÿ/ä½å®¿ -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-2">
            ${mealsBlock(det.meals || {})}
            ${lodgingBlock(det.lodging || '')}
          </div>
          <!-- å±•é–‹è¡Œç¨‹å…§å®¹ -->
          <details class="border rounded-xl mt-2 mb-6 group">
            <summary class="w-full flex items-center justify-between px-3 py-2 text-sm cursor-pointer list-none">
              <span class="flex items-center gap-2"><span class="chev transition-transform group-open:rotate-180">â–¾</span> å±•é–‹è¡Œç¨‹å…§å®¹</span>
            </summary>
            <div class="px-4 pb-3 text-sm text-gray-600 space-y-4">
              ${(det.sections||[]).map(sec=>`
                <div>
                  <div class="font-medium text-gray-800 mb-1">${sec.title}</div>
                  ${ul(sec.items||[])}
                </div>
              `).join('')}
            </div>
          </details>
        </div>`;

      // ç”¢ç”Ÿæ¯æ—¥è¡Œç¨‹å¡ç‰‡
      function renderItinerary(){
        const wrap = document.getElementById('itineraryList');
        wrap.innerHTML = DATA.itinerary.map(d => cardHTML(d, DETAILS[d.day]||{})).join('');
      }

      // åœ–ç‰‡å±•ç¤ºæ¨¡å¼åˆ‡æ›ï¼ˆä¸€è‡´å°ºå¯¸ â‡„ åŸæ¯”ä¾‹ï¼‰
      function bindModeToggle(){
        const btn = document.getElementById('modeToggle');
        if(!btn) return;
        const sync = () => btn.textContent = document.body.classList.contains('mode-natural') ? 'é¡¯ç¤ºæ¨¡å¼ï¼šåŸæ¯”ä¾‹' : 'é¡¯ç¤ºæ¨¡å¼ï¼šä¸€è‡´å°ºå¯¸';
        btn.addEventListener('click', ()=>{ document.body.classList.toggle('mode-natural'); sync(); });
        sync();
      }

      // Lightboxï¼ˆé»åœ–æ”¾å¤§ / Esc é—œé–‰ / é»èƒŒæ™¯é—œé–‰ï¼‰
      function bindLightbox(){
        const lb = document.getElementById('lightbox');
        const lbImg = document.getElementById('lightboxImg');
        const lbClose = document.getElementById('lightboxClose');
        if(!lb || !lbImg) return;
        document.querySelectorAll('.gallery-grid img').forEach(img => {
          img.addEventListener('click', () => {
            lbImg.src = img.getAttribute('data-fullsrc') || img.src;
            if(typeof lb.showModal === 'function') lb.showModal();
          }, {passive:true});
        });
        lbClose && lbClose.addEventListener('click', ()=> lb.close());
        lb.addEventListener('click', (e)=>{ if(e.target===lb) lb.close(); });
        window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && lb.open) lb.close(); });
      }
      // å¤–é€£åœ–ç‰‡å®¹éŒ¯ï¼ˆé¿å…éƒ¨åˆ†ç«™é»é˜»æ“‹ hotlinkï¼‰
      function proxyURL(u, opts={}){
        try{
          const x = new URL(u);
          const params = new URLSearchParams();
          const w = opts.w || 1280; // responsive enough for mobile/most laptops
          params.set('url', x.host + x.pathname + (x.search||''));
          params.set('w', w);
          params.set('output', 'webp');
          return 'https://images.weserv.nl/?' + params.toString();
        }catch(e){
          return u;
        }
      }
      function bindImgFallback(){
        const attach = (img)=>{
          const toProxy = () => {
            if(img.dataset.fallback) return;
            img.dataset.fallback = '1';
            img.src = proxyURL(img.src);
          };
          // 1) On hard error, switch to proxy immediately
          img.addEventListener('error', toProxy, {passive:true});
          // 2) Smart fallback: if not loaded within 2500ms after intersecting, switch to proxy
          let timer = null;
          const onEnter = (entries)=>{
            entries.forEach(en=>{
              if(en.isIntersecting){
                if(img.complete) return; // already cached/loaded
                if(timer) return;
                timer = setTimeout(()=>{ if(!img.complete) toProxy(); }, 2500);
              }
            });
          };
          // Use per-image IO so timing is isolated
          const io = new IntersectionObserver(onEnter, {rootMargin: '200px'});
          io.observe(img);
          // Clear timer on successful load
          img.addEventListener('load', ()=>{ if(timer){ clearTimeout(timer); timer=null; } }, {passive:true});
        };
        document.querySelectorAll('img').forEach(attach);
        const obs = new MutationObserver((muts)=>{
          muts.forEach(m=>{
            m.addedNodes && m.addedNodes.forEach(node=>{
              if(node.nodeType===1){
                if(node.tagName==='IMG') attach(node);
                node.querySelectorAll && node.querySelectorAll('img').forEach(attach);
              }
            });
          });
        });
        obs.observe(document.body, {childList:true, subtree:true});
      }
      // åˆå§‹åŒ–
      renderItinerary();
            bindModeToggle();
      bindLightbox();
      bindImgFallback();
    </script>
  </body>
</html>
